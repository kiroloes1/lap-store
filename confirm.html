<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="canonical" href="https://getbootstrap.com/docs/5.3/examples/sidebars/">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3">
    <link href="./dist/css/bootstrap.min.css" rel="stylesheet">
                <!-- fontawesom -->
                <link
                rel="stylesheet"
                href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
                integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
                crossorigin="anonymous"
                referrerpolicy="no-referrer"
   />
              <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:ital,wght@0,100..900;1,100..900&family=Indie+Flower&family=Lexend:wght@100..900&family=Permanent+Marker&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
        
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>confirm</title>
</head>




<style>

    *{
font-family: "Lexend", sans-serif;

}
.navbar i{
margin-right:3vh;
font-size: xx-large;

}
nav{
background-color:rgb(3, 32, 49) ;

}

.navbar-brand {
margin-right: -70px;
}


i{
color: #f1d29a;
}
nav i:hover{
cursor: pointer;
scale: 1.1;


}
.navbar{
width:auto;
}
@media (min-width: 600px) and (max-width:900px) {
.navbar{
width:113%;
}
}

@media (min-width: 900px) and (max-width: 1065px) {
.navbar {
width: 105%;
}
}
.navbar-nav a{
color: aliceblue;
}
.search{
background-color:#f1d39ad0 ;
color: #000;

}
.search::placeholder{


color:rgb(0, 0, 0);
font-size: large;
}
.search:focus{
   
color:rgb(243, 238, 238);
font-size: large;
background-color: #3f3e3c33;
}
body::-webkit-scrollbar{
        border-radius: 2vh;
        width:6px;
        height: 1px;
        scroll-behavior: smooth;
      }
    body::-webkit-scrollbar{
        width: 8px;
        height: 0;
      }

      
      body::-webkit-scrollbar-track{
        background-color: rgb(46, 61, 75);
        width:5px;
        
        
        
        border-radius: 2vh;
      }

    body::-webkit-scrollbar-thumb{
        background-color: rgb(233, 177, 24);
        
        border-radius: 2vh;
       
      }

  body::-webkit-scrollbar-thumb:hover{
    background-color: rgb(200, 150, 20);
}
.detailsProduct p{
    font-size: large;
    color: rgb(9, 60, 126);

}
.detailsProduct span{
   font-size: large;
   font-weight: 700;
   color: #000;


}

/* تنسيق النجوم */
.star {
    font-size: 24px;
    cursor: pointer;
    color: gray; /* اللون الافتراضي */
    transition: color 0.3s ease-in-out, transform 0.2s;
}

/* عند تحريك الماوس فوق النجوم */
.star:hover {
    transform: scale(1.2);
    color: gold;
}

/* عند الضغط على النجوم يتم تلوينها */
.star.selected {
    color: gold;
}




</style>

<link rel="icon" href="./pic/laptop.png">
</head>
<body>

<!-- start navbar  -->

<nav class="navbar bg-dark navbar-expand-lg position-fixed-lg ">
<div class="container">

<a  class="navbar-brand  " href="./index.html"><img class="w-50 "  src="./pic/pic_log.png " alt="logo"></a>
<button class="navbar-toggler bg-white" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
<span class="navbar-toggler-icon"></span>
</button>
<div class="collapse navbar-collapse" id="navbarSupportedContent">
<div class="col"></div>
<form class="d-flex" role="search">
  <input class="form-control me-2 rounded-4 search" type="search" placeholder="Search" aria-label="Search">
  <div><i class="fa-solid fa-magnifying-glass my-2 me-5 ms-1 "></i></div>
  <a href="./login.html" class="login btn  rounded-3 fw-medium px-3 ">login</a>
</form>
</div>
</div>
</nav>

<div  class=" container  detailsProduct  mt-5">
   
</div>



    <div class="container mt-5 d">
       
    
    </div>
    <div class="m-5"></div>
    <div class="container mt-5 p-5">
        <h2 class="text-center">Customer Reviews</h2>
        <table class="table table-bordered text-center mt-3">
            <thead class="table-dark">
                <tr>
                    <th>Customer Name</th>
                    <th>Rating</th>
                    <th>Review</th>
                </tr>
            </thead>
            
            <tbody id="reviewsTable"></tbody>
        </table>
    
        <!-- Form to Add Review -->
        <h4 class="mt-4">Leave a Review</h4>
        <form id="reviewForm">
            <div class="mb-3">
                <input type="text" id="customerName" class="form-control" placeholder="Your Name" required>
            </div>
            <div class="mb-3">
                <textarea id="customerReview" class="form-control" placeholder="Your Review" required></textarea>
            </div>
            <div class="mb-3">
                <label>Rating:</label>
                <span class="star" data-value="1">★</span>
                <span class="star" data-value="2">★</span>
                <span class="star" data-value="3">★</span>
                <span class="star" data-value="4">★</span>
                <span class="star" data-value="5">★</span>
            </div>
            <button type="submit" class="btn btn-dark">Submit Review</button>
        </form>
    </div>


         <!-- sweetAlert2 (library) -->
 <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
 <script src="./assets/dist/js/bootstrap.bundle.min.js"></script>
 <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

 <script>

let selectedRating;
let update= JSON.parse(localStorage.getItem("allproducts"));
let value=0;
let Rating= localStorage.getItem("productRating") || 0;
function x(list,index ,selectedRating){


for(let i=0;i<update.length;i++){
if((list[index].name==update[i].name)){
console.log("k")
let Z=[]


update[i].rating=+selectedRating;

}
}
localStorage.setItem("allproducts", JSON.stringify(update));
}
 
    document.addEventListener("DOMContentLoaded", function () {
        emailjs.init("1sHuuplna5AR2vMrO"); // تأكد من استبداله بالمفتاح الصحيح
    
        let details = document.querySelector(".detailsProduct");
        
        let list, index;
    
        if (!localStorage.getItem("index")) {
            list = JSON.parse(localStorage.getItem("detail"));
            index = 0;
            list[0].bn += 1;
        } else {
            list = JSON.parse(localStorage.getItem("productX"));
            index = localStorage.getItem("index");
        }
    
        display(list, index);


    
        function display(list, index) {
               // تحديث النجوم عند الاختيار
    document.querySelectorAll(".star").forEach(star => {
        star.addEventListener("click", function () {
            selectedRating =+(this.getAttribute("data-value"));
            updateStars(selectedRating);
            x(list,index ,selectedRating)
        });

        star.addEventListener("mouseover", function () {
            updateStars(this.getAttribute("data-value"));
        });

        star.addEventListener("mouseleave", function () {
            updateStars(selectedRating);
            console.log(+selectedRating)
        });
    });

    function updateStars(value) {
        document.querySelectorAll(".star").forEach(star => {
            star.classList.toggle("active", star.getAttribute("data-value") <= value);
        });
    }


            
            details.innerHTML = "";
            let table = `
                <h2 class="text-center mb-4">Order Details</h2>
                <form id="orderForm" class="row border p-5 bg-body-tertiary">
                    <div class="mb-3 col-md-6 border pt-3 d-flex justify-content-center rounded-4">
                        <p> <span> Product Name : </span>${list[index].name} </p>
                    </div>
                    <div class="mb-3 col-md-6 border pt-3 d-flex justify-content-center rounded-4">
                        <p> <span> Product Count :</span> ${list[index].bn} </p>
                    </div>
                    <div class="mb-3 col-md-6 border pt-3 d-flex justify-content-center rounded-4">
                        <p> <span> Product Price :</span> ${list[index].price} </p>
                    </div>
                    <div class="mb-3 col-md-6 border pt-3 d-flex justify-content-center rounded-4">
                        <p> <span> Total Price : </span>${list[index].price * list[index].bn} </p>
                    </div>
                    <div class="mb-3 col-md-12 border pt-3 d-flex justify-content-center rounded-4">
                        <p> <span> Category :</span> ${list[index].id} </p>
                    </div>
    
                    <!-- إدخال بيانات العميل -->
                   
                     <h2 class="text-center mb-4 mt-5">confirm your Order </h2>
                         <div class="mb-3 col-md-6">
                <label for="name" class="form-label">Full Name</label>
                <input type="text" class="form-control" id="name" placeholder="Enter your name" required>
            </div>
    
            <div class="mb-3 col-md-6">
                <label for="email" class="form-label">Email Address</label>
                <input type="email" class="form-control" id="email" placeholder="Enter your email" required>
            </div>
    
            <div class="mb-3 col-md-6">
                <label for="whatsapp" class="form-label">WhatsApp Number</label>
                <input type="tel" class="form-control" id="whatsapp" placeholder="Enter your WhatsApp number" required>
            </div>
    
            <div class="mb-3 col-md-6">
                <label for="address" class="form-label">Delivery Address</label>
                <input type="text" class="form-control" id="address" placeholder="Enter your address" required>
            </div>
    
            <div class="mb-3 col-md-6">
                <label for="delivery-date" class="form-label">Delivery Date</label>
                <input type="date" class="form-control" id="delivery-date" required>
            </div>
    
            <div class="mb-3 col-md-6">
                <label for="delivery-location" class="form-label">Delivery Location</label>
                <input type="text" class="form-control" id="delivery-location" placeholder="Enter delivery location" required>
            </div>
    
            <div class="mb-3 col-md-6">
                <label for="alternative-location" class="form-label">Alternative Location (if unavailable)</label>
                <input type="text" class="form-control" id="alternative-location" placeholder="Enter alternative location">
            </div>
    
            <div class="text-center">
                <button type="submit" class="btn btn-dark px-5">Submit</button>
            </div>
                </form>
                
            `;
            details.innerHTML += table;
           
            localStorage.removeItem("index");
    
            // أضف مستمع الحدث عند إنشاء الفورم
            document.getElementById("orderForm").addEventListener("submit", sendEmail);


  console.log( JSON.parse(localStorage.getItem("allproducts")))
        }
    
        function sendEmail(event) {
            event.preventDefault(); // منع إعادة تحميل الصفحة
    
            // استخراج بيانات الفورم
            const formData = {
                name: document.getElementById("name").value,
                email: document.getElementById("email").value,
                whatsapp: document.getElementById("whatsapp").value,
                address: document.getElementById("address").value,
                delivery_date: document.getElementById("delivery-date").value,
                delivery_location: document.getElementById("delivery-location").value,
                alternative_location: document.getElementById("alternative-location").value,
                product_name: list[index].name,
                product_type: list[index].id,
                product_count: list[index].bn,
                product_price: list[index].price,
                total_price: list[index].price * list[index].bn,
            };
    
            // تعطيل الزر أثناء الإرسال
            const submitButton = document.querySelector("button[type='submit']");
            submitButton.disabled = true;
            submitButton.innerText = "Sending...";
    
            // إرسال البيانات عبر EmailJS
            emailjs.send("service_kpi033a", "template_qvz78in", formData)
                .then(response => {
                    // نجاح الإرسال
                    Swal.fire({
                        title: "Sent!",
                        text: "Your order has been sent successfully!",
                        icon: "success",
                        confirmButtonText: "OK",
                        confirmButtonColor: "green",
                    });
    
                    // إعادة تعيين الفورم
                    document.getElementById("orderForm").reset();
                    list[index].bn = 0;
                    localStorage.setItem("productX", JSON.stringify(list));

                    localStorage.setItem("check", 1);
                })
                .catch(error => {
                    // فشل الإرسال
                    Swal.fire({
                        title: "Error",
                        text: "Something went wrong while sending your order. Please try again.",
                        icon: "error",
                        confirmButtonText: "OK",
                        confirmButtonColor: "red",
                    });
                    console.error("Error:", error);
                    localStorage.setItem("check", 0);
                })
                .finally(() => {
                    // إعادة تمكين الزر بعد الإرسال
                    submitButton.disabled = false;
                    submitButton.innerText = "Submit";
                });
        }
    });


    </script>
    
</body>
</html>